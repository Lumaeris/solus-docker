FROM scratch as builder
ADD ./solus /
ADD ./solus/usr/share/factory /

# remove all pkgs except for system.base, list of all iso pkgs came from https://raw.githubusercontent.com/getsolus/packages/refs/heads/main/common/iso_packages.txt
RUN eopkg rm -y aalib abseil-cpp accounts-qml-module accountsservice adwaita-icon-theme adwaita-icon-theme-legacy adw-gtk3-theme aha alsa-firmware alsa-lib alsa-plugins alsa-ucm-conf alsa-utils aom appstream appstream-data appstream-glib appstream-qt6 argon2 ark assimp atkmm at-spi2 attica avahi baloo-widgets baobab bcachefs-tools bind-utils binutils binutils-libs blake3 bluedevil blueman bluez bolt botan2 breeze breeze-cursor-theme breeze-gtk-theme breeze-icons breeze-light-cursor-theme bubblewrap budgie-backgrounds budgie-control-center budgie-desktop budgie-desktop-branding budgie-desktop-branding-livecd budgie-desktop-view budgie-screensaver budgie-session cairomm cairomm-1.16 caja calamares canon-ufriilt-common celluloid celt ceres-solver cfitsio chromaprint cinnamon-translations clinfo clutter clutter-gst clutter-gtk cogl coinmp colord colord-kde cracklib cups cups-browsed cups-filters cups-pk-helper cyrus-sasl dav1d dbus-launch dconf ddcutil dejavu-fonts-ttf desktop-file-utils discount djvulibre dmidecode docbook-xml doflicky dolphin dolphin-plugins dosfstools dotconf double-conversion dracut drkonqi ebook-tools editorconfig-core-c efibootmgr elfutils elisa enchant engrampa espeak-ng evince evolution-data-server exfatprogs exiv2 exo f2fs-tools faad fdk-aac ffmpeg ffmpeg-4.4 ffmpegthumbnailer ffmpegthumbs fftw file-roller firefox flashrom flatpak flatpak-kcm fluidsynth fontconfig font-droid-ttf font-hack-ttf font-tlwg-ttf foomatic-db foomatic-db-engine frameworkintegration freeglut freepats freerdp freetype2 fribidi fuse fuse2 fuse-common fwupd fwupd-efi garcon gcab gcr gcr-4 gd gdb gdbm gdk-pixbuf gdm gedit geoclue gexiv2 gflags ghostscript giflib gjs glibmm glibmm-2.68 glib-networking glog glycin gmmlib gnome-autoar gnome-bluetooth gnome-bluetooth-1 gnome-bluetooth-1-common gnome-browser-connector gnome-calculator gnome-calendar gnome-clocks gnome-color-manager gnome-control-center gnome-desktop-branding gnome-desktop-branding-livecd gnome-disk-utility gnome-keyring gnome-online-accounts gnome-online-accounts-gtk gnome-remote-desktop gnome-screenshot gnome-session gnome-session-shell gnome-settings-daemon gnome-shell gnome-shell-extension-appindicator gnome-shell-extension-apps-menu gnome-shell-extension-auto-move-windows gnome-shell-extension-native-window-placement gnome-shell-extensions gnome-shell-extension-screenshot-window-sizer gnome-shell-extension-speedinator gnome-shell-extension-user-theme gnome-shell-extension-window-list gnome-system-monitor gnome-terminal gnome-text-editor gnome-themes-extra gnome-tweaks gnome-user-docs gnome-video-effects gnome-weather gnupg gnuplot gpart gparted gpgme gptfdisk graphene graphite2 graphviz grilo groff group-service grub2 gsettings-desktop-schemas gsm gsound gspell gssdp gstreamer-1.0 gstreamer-1.0-libav gstreamer-1.0-plugins-bad gstreamer-1.0-plugins-base gstreamer-1.0-plugins-good gstreamer-1.0-plugins-rs gstreamer-1.0-plugins-ugly gtk2-engine-murrine gtk-engines gts gupnp gupnp-igd gutenprint gvfs gvfs-goa gwenview harfbuzz haruna hdf5 hicolor-icon-theme highway hplip-drivers hunspell-en hwloc hyphen ibus iceauth iio-sensor-proxy iksemel imagemagick imath imlib2 inih intel-media-driver intel-microcode intel-tbb inxi iproute2 iptables jack-audio-connection-kit jasper jbig2dec kaccounts-integration kaccounts-providers kactivitymanagerd kamera karchive kate kauth kbd kbookmarks kcalc kcharselect kcodecs kcolorpicker kcompletion kconfig kconfigwidgets kcoreaddons kcrash kdbusaddons kde-cli-tools kdeconnect kdecoration kded kdegraphics-mobipocket kdegraphics-thumbnailers kde-gtk-config kde-inotify-survey kdenetwork-filesharing kdeplasma-addons kdnssd kdoctools kdsoap-qt5 kdsoap-qt6 kdsoap-ws-discovery-client keybinder keyutils kf5-kwayland kf6-attica kf6-baloo kf6-bluez-qt kf6-frameworkintegration kf6-karchive kf6-kauth kf6-kbookmarks kf6-kcalendarcore kf6-kcmutils kf6-kcodecs kf6-kcolorscheme kf6-kcompletion kf6-kconfig kf6-kconfigwidgets kf6-kcontacts kf6-kcoreaddons kf6-kcrash kf6-kdbusaddons kf6-kdeclarative kf6-kded kf6-kdesu kf6-kdnssd kf6-kdoctools kf6-kfilemetadata kf6-kglobalaccel kf6-kguiaddons kf6-kholidays kf6-ki18n kf6-kiconthemes kf6-kidletime kf6-kimageformats kf6-kio kf6-kirigami kf6-kitemmodels kf6-kitemviews kf6-kjobwidgets kf6-knewstuff kf6-knotifications kf6-knotifyconfig kf6-kpackage kf6-kparts kf6-kpeople kf6-kpty kf6-kquickcharts kf6-krunner kf6-kservice kf6-kstatusnotifieritem kf6-ksvg kf6-ktexteditor kf6-ktextwidgets kf6-kunitconversion kf6-kuserfeedback kf6-kwallet kf6-kwidgetsaddons kf6-kwindowsystem kf6-kxmlgui kf6-modemmanager-qt kf6-networkmanager-qt kf6-prison kf6-purpose kf6-qqc2-desktop-style kf6-solid kf6-sonnet kf6-syndication kf6-syntax-highlighting kf6-threadweaver kgamma kglobalaccel kglobalacceld kguiaddons ki18n kiconthemes kimageannotator kinfocenter kio kio-extras kio-fuse kio-gdrive kirigami2 kirigami-addons kitemviews kjobwidgets kmenuedit knewstuff knotifications konsole kpackage kpipewire kpmcore kscreen kscreenlocker kservice ksshaskpass ksystemstats ktextwidgets kuserfeedback kwallet kwalletmanager kwallet-pam kwayland kwayland-integration kwidgetsaddons kwin kwindowsystem kwrited kxmlgui ladspa lame lapack layer-shell-qt ldb ldns liba52dec libabw libaccounts-glib libaccounts-qt libadwaita libao libarchive libass libassuan libatasmart libavc1394 libavif libayatana-appindicator libayatana-ido libayatana-indicator libb2 libblockdev libbluray libboost libbs2b libburn libbytesize libcaca libcairo libcanberra libcddb libcdio libcdio-paranoia libcdr libcheese libcinnamon-desktop libcloudproviders libcmis libcolord-gtk libconfuse libcue libcupsfilters libdaemon libdbusmenu libdbusmenu-qt libdc1394 libde265 libdecor libdisplay-info libdmtx libdovi libdrm libdv libdvbpsi libdvdcss libdvdnav libdvdread libebml libe-book libedit libei libepoxy libetonyek libevdev libevent libexempi libexif libexttextcat libfakekey libflac libfontenc libfreeaptx libfreehand libftdi1 libgdata libgedit-amtk libgedit-gfls libgedit-gtksourceview libgedit-tepl libgee libgeocode-glib2 libgeocode-glib-common libgfortran libglu libglvnd libgnome-desktop libgnomekbd libgnome-menus libgnutls libgphoto2 libgsf libgtk-2 libgtk-3 libgtk-4 libgtk-layer-shell libgtkmm-3 libgtkmm-4 libgtksourceview4 libgtksourceview5 libgtop libgweather libgxps libhandy libheif libhogweed libhunspell libical libice libid3tag libidn libiec61883 libieee1284 libimobiledevice libimobiledevice-glue libinput libinstpatch libiptcdata libisofs libixion libjcat libjpeg-turbo libjxl libkate libkdcraw libkexiv2 libkgapi libksba libkscreen libksysguard liblangtag liblc3 liblcms2 libldac libltc libmatroska libmaxminddb libmbim libmfx libmicrohttpd libmnl libmodplug libmpeg2 libmspack libmspub libmtp libmwaw libndp libnfnetlink libnfs libnftnl libnice libnl libnma libnotify libnumbertext libnvme liboauth libodfgen libogg libomp libopenmpt liborcus libosinfo libp11-kit libpagemaker libpaper libparted libpcap libpciaccess libpcre libpeas libphonenumber libplacebo libplasma libplist libpng libportal libportal-gtk4 libppd libproxy libpsl libpwquality libqaccessibilityclient libqalculate libqmi libqrtr-glib libqxp libraw libraw1394 libreoffice-calc libreoffice-common libreoffice-common-kde-integration libreoffice-draw libreoffice-impress libreoffice-writer librest librevenge librsvg libsamplerate libsecret libselinux libshout libsigc++ libsigc++30 libsm libsndfile libsodium libsoup libsoup3 libsoxr libspectre libspeex libspelling libsrtp libssh libstartup-notification libstemmer libtasn1 libtelepathy-glib libtheora libtiff libtirpc libtool libunibreak libunwind libupnp liburcu liburing libusbmuxd libutempter libuv libva libva-intel-driver libvdpau libvisio libvncserver libvoikko libvorbis libvpl libvpx libvte libwacom libwebkit-gtk libwebkit-gtk41 libwebkit-gtk6 libwebp libwnck libwpd libwpg libwps libx11 libxau libxcb libxcomposite libxcursor libxcvt libxdamage libxdmcp libxext libxfce4ui libxfce4util libxfce4windowing libxfixes libxfont2 libxft libxi libxinerama libxkbcommon libxkbfile libxklavier libxmlb libxmu libxpm libxpresent libxrandr libxrender libxres libxscrnsaver libxshmfence libxt libxtst libxv libxvmc libxxf86dga libxxf86vm libyuv libzip libzmf lightdm lilv linux-current linux-driver-management-gdm-integration linux-driver-management-lightdm-integration linux-driver-management-sddm-integration linux-firmware linux-firmware-nvidia llvm-libs lmdb lm_sensors localsearch loupe lrdf lrzip lsb-release lsof lua luajit lzo magpie man-db mariadb-common mate-desktop-libs materia-gtk-theme materia-gtk-theme-compact materia-gtk-theme-dark materia-gtk-theme-dark-compact materia-gtk-theme-light materia-gtk-theme-light-compact mate-user-admin md4c mdadm media-player-info mesa-demos mesalib metis microdns milou minizip-ng mkfontscale mobile-broadband-provider-info modem-manager mousepad mozjs mpg123 mpv-libs mpvqt msgraph mtdev mtools mugshot mutagen mutter mutter-common mythes nano nano-syntax-highlighting nautilus nautilus-extension nautilus-python nemo nemo-fileroller neon net-snmp network-manager network-manager-applet network-manager-livecd networkmanager-openconnect networkmanager-openvpn newt nftables noto-sans-ttf noto-serif-ttf npth nss-mdns ntfs-3g numpy nvidia-470-glx-driver-modaliases nvidia-glx-driver-modaliases ocl-icd okular onboard openal-soft openblas openconnect opencv openexr openjpeg openldap openssh openvpn opus orc orca osinfo-db os-prober ostree oxygen-sounds p7zip packagekit packagekit-qt-qt6 pango pangomm pangomm-2.48 papirus-icon-theme parole parted partitionmanager pavucontrol pcaudiolib pciutils pcsc-lite perl perl-common-sense perl-json-xs perl-net-dbus perl-types-serialiser perl-x11-protocol perl-xmlparser perl-xml-twig phonon-backend-vlc phonon-qt5 phonon-qt6 pinentry pipewire pipewire-lib pixman pkcs11-helper plasma5support plasma-activities plasma-activities-stats plasma-browser-integration plasma-desktop plasma-desktop-branding plasma-desktop-branding-livecd plasma-disks plasma-integration plasma-nm plasma-pa plasma-systemmonitor plasma-thunderbolt plasma-wayland-protocols plasma-welcome plasma-workspace polkit-gnome polkit-kde-agent polkit-qt-1-qt5 polkit-qt-1-qt6 polly poppler poppler-data poppler-qt6 poppler-utils portaudio postgresql-libpq powerdevil power-profiles-daemon ppp print-manager protobuf protobuf-c ptyprocess pulseaudio pulseaudio-qt pyatspi2 pycups python2-gobject python3-cairo python3-pycryptodome python3-pyudev python-cairo python-certifi python-cffi python-chardet python-charset-normalizer python-cparser python-cryptography python-eopkg python-gobject python-idna python-libevdev python-openssl python-ordered-set python-pexpect python-psutil python-pycurl python-pygdbmi python-pysmbc python-pysocks python-requests python-sentry-sdk python-six python-urllib3 python-websockets python-xattr qadwaitadecorations qca-qt6 qcoro-qt6 qemu-guest-agent qogir-gtk-theme qpdf qqc2-desktop-style qrencode qt5-base qt5-declarative qt5-graphicaleffects qt5-quickcontrols2 qt5-speech qt5-svg qt5-wayland qt5-x11extras qt6-5compat qt6-base qt6-charts qt6-declarative qt6-imageformats qt6-multimedia qt6-positioning qt6-quick3d qt6-quicktimeline qt6-sensors qt6-serialport qt6-shadertools qt6-speech qt6-svg qt6-tools qt6-virtualkeyboard qt6-wayland qt6-webchannel qt6-webengine qt6-websockets qtkeychain-qt6 qtstyleplugins raptor2 raqm rav1e re2 reiserfsprogs rhythmbox rhythmbox-alternative-toolbar ristretto rsync rtkit rtmpdump rubberband samba sane-backends sbc sddm sddm-kcm sdl1 sdl1-image sdl2 sdl2-ttf seahorse serd setxkbmap shaderc shared-mime-info signond signon-kwallet-extension signon-plugin-oauth2 signon-ui slang slick-greeter smartmontools snappy snapshot socat sof-firmware solid solus-artwork solus-artwork-plasma solus-hardware-config solus-sc solus-sc-icons sonnet sord sound-theme-freedesktop soundtouch spectacle speech-dispatcher spice-vdagent spirv-tools sratom srt sshfs-fuse stoken suitesparse svt-av1 switcheroo-control syndication syntax-highlighting system-config-printer systemsettings taglib talloc tcl tdb tecla telepathy-logger tevent thunar thunar-archive-plugin thunar-shares-plugin thunar-volman thunderbird tinysparql totem-pl-parser tree tslib tumbler twolame uchardet udisks unicode-character-database unixodbc unrar upower usb-modeswitch usbmuxd v4l-utils vala-panel-appmenu vamp-plugin-sdk vapoursynth vid.stab vlc-core vo-aacenc volume_key vpnc vulkan vulkan-tools wacomtablet wavpack wayland wayland-utils webp-pixbuf-loader webrtc-audio-processing wget wildmidi wireless-tools wireplumber woff2 wpa_supplicant wsdd wxwidgets x264 x265 xapp xauth xcb-util xcb-util-cursor xcb-util-image xcb-util-keysyms xcb-util-renderutil xcb-util-wm xdg-dbus-proxy xdg-desktop-portal xdg-desktop-portal-gnome xdg-desktop-portal-gtk xdg-desktop-portal-kde xdg-desktop-portal-xapp xdg-user-dirs xdg-user-dirs-gtk xdg-utils xdotool xdpyinfo xfburn xfce4-appfinder xfce4-desktop-branding xfce4-desktop-branding-livecd xfce4-notifyd xfce4-panel xfce4-panel-profiles xfce4-power-manager xfce4-pulseaudio-plugin xfce4-screensaver xfce4-screenshooter xfce4-session xfce4-settings xfce4-taskmanager xfce4-terminal xfce4-whiskermenu-plugin xfce4-xkb-plugin xfconf xfdesktop xfsdump xfsprogs xfwm4 xhost xinit xkbcomp xkeyboard-config xmlsec1 xmodmap xorg-driver-input-libinput xorg-driver-input-synaptics xorg-driver-input-wacom xorg-driver-video-amdgpu xorg-driver-video-fbdev xorg-driver-video-intel xorg-driver-video-nouveau xorg-driver-video-qxl xorg-driver-video-radeon xorg-driver-video-vesa xorg-driver-video-vmware xorg-server xorg-server-xvfb xorg-xwayland xprop xrandr xrdb xreader xset xsetroot xsettingsd xvidcore xviewer xwaylandvideobridge xxhash yaml yaml-cpp yelp yelp-xsl yt-dlp zbar zenity zimg zix zlib-ng zram-generator zram-generator-defaults zxing-cpp; \
    rm -r \
        /var/lib/eopkg/index/Solus/* \
        /var/cache/*; \
    eopkg dc;

FROM scratch
COPY --from=builder / /
